<!DOCTYPE html>
{% extends "layout.template.html" %} 
{% block title %}Profile Update{% endblock %} 
{% block content %}
<form method="POST">
    <div class="card" style="width: 18rem;">        
        <img class="card-img-top" src="{{profile.uploaded_image_url}}" id="uploaded_image" alt="Member Company name"/>
        <div class="card-body">
            <h5 class="card-title">WM Group</h5>
            <input type="text card-text" class="form-control mt-3" name="description" value="{{profile.description}}"/>
            <a id="upload_widget" class="btn btn-primary btn-sm">Edit Image</a>
            <input type="hidden" id="uploaded_image_url" name="uploaded_image_url" value="{{profile.uploaded_image_url}}"/>
            <a href="#" class="btn btn-primary btn-sm">Save</a>
        </div> 
    </div>
</form>

<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  

<script type="text/javascript">  
    let myWidget = cloudinary.createUploadWidget({
        cloudName: '{{cloud_name}}', 
        uploadPreset: '{{upload_preset}}'}, (error, result) => { 
            if (!error && result && result.event === "success") { 
            console.log('Done! Here is the image info: ', result.info); 
            let fileURL = document.querySelector("#uploaded_image_url");
            fileURL.value = result.info.url;

            document.querySelector('#uploaded_image').src = result.info.url;

            }
        }
    )
    
    document.getElementById("upload_widget").addEventListener("click", function(){
        myWidget.open();
    }, false);
</script>
{% endblock %}