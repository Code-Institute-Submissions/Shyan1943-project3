<!DOCTYPE html>
{% extends "layout.template.html" %} 
{% block title %}Create Profile{% endblock %} 
{% block content %}
    <form method="POST">
        <div>
            <a id="upload_widget" class="cloudinary-button mt-3">Upload Image</a>
            <input type="hidden" id="uploaded_image_url" name="uploaded_image_url"/>
        </div>
        <div>
            <input type="text" class="form-control mt-3" name="description" placeholder="Enter description"/>
        </div>
        <div>
            <input type="submit" class="mt-3" value="Create a post"/>
        </div>
    </form>

    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  

    <script type="text/javascript">  
        let myWidget = cloudinary.createUploadWidget({
            cloudName: '{{cloud_name}}', 
            uploadPreset: '{{upload_preset}}'}, (error, result) => { 
                if (!error && result && result.event === "success") { 
                console.log('Done! Here is the image info: ', result.info); 
                let fileURL = document.querySelector("#uploaded_image_url");
                fileURL.value = result.info.url;
                }
            }
        )
        
        document.getElementById("upload_widget").addEventListener("click", function(){
            myWidget.open();
        }, false);
    </script>
{% endblock %}
